http:
  middlewares:
    secure-headers:
      headers:
        customResponseHeaders:
          X-Frame-Options: "DENY"
          X-Content-Type-Options: "nosniff"
          Referrer-Policy: "strict-origin-when-cross-origin"
          Permissions-Policy: "geolocation=(), microphone=(), camera=()"
        customRequestHeaders:
          X-Forwarded-Proto: "https"

  routers:
    laboratorio:
      # Configuración para bolsa.kronos.cloudns.ph (Frontend)
      rule: "Host(`bolsa.kronos.cloudns.ph`)"
      priority: 10
      service: laboratorio-service
      entryPoints:
        - https
      tls:
        certResolver: myresolver

    laboratorio-backend:
      # Configuración para el Backend (API)
      # Enruta /api, /docs y /openapi.json al backend
      rule: "Host(`bolsa.kronos.cloudns.ph`) && (PathPrefix(`/api`) || PathPrefix(`/docs`) || PathPrefix(`/openapi.json`))"
      priority: 20
      service: laboratorio-backend-service
      entryPoints:
        - https
      middlewares:
        - secure-headers # IMPORTANTE: Forzar X-Forwarded-Proto: https
      tls:
        certResolver: myresolver

  services:
    laboratorio-service:
      loadBalancer:
        servers:
          - url: "http://192.168.0.8:3000"

    laboratorio-backend-service:
      loadBalancer:
        servers:
          - url: "http://192.168.0.8:8000"
